(function(){"use strict";const{Plugin:d}=require("powercord/entities"),{getModule:n,messages:g}=require("powercord/webpack"),{forceUpdateElement:l}=require("powercord/util"),{inject:u,uninject:p}=require("powercord/injector"),h=require("./Settings");module.exports=class extends d{constructor(){super();this.classes={messages:n(["messages","scroller"],!1),messageContent:n(["wrapper","username"],!1),container:n(["container","embedWrapper"],!1),markup:n(["markup"],!1)},Object.keys(this.classes).forEach(s=>this.classes[s]=`.${this.classes[s][s]}`)}get currentUser(){return window.__SENTRY__.hub.getScope()._user}async startPlugin(){powercord.api.settings.registerSettings("pc-clickableEdits",{category:this.entityID,label:"Clickable Edits",render:h}),this.patchMessageContent()}pluginWillUnload(){powercord.api.settings.unregisterSettings("pc-clickableEdits"),p("clickableEdits-message"),l(this.classes.messages)}async patchMessageContent(){const s=(r,t)=>{const{childrenMessageContent:{props:{message:i}}}=r[0];return i&&i.author.id===this.currentUser.id&&(t.props.children.props.onMouseUp=this.handleMessageEdit(i.channel_id,i.id,i.content)),t},a=await n(r=>(r.__powercordOriginal_default||r.default)?.toString().includes("childrenRepliedMessage"));u("clickableEdits-message",a,"default",s),a.default.displayName="Message",l(this.classes.messages)}handleMessageEdit(s,a,r){const t=e=>this.settings.get(e,!1),i=e=>e.shiftKey&&e.button===(t("rightClickEdits")?2:0)&&e.detail===1,o=e=>e.button===(t("rightClickEdits")?2:0)&&e.detail>1;let c=[s,a,t("clearContent")?"":r];const f=e=>t("dualControlEdits")&&i(e)?c=[s,a,""]:o(e)?c=[s,a,r]:!1;return e=>{(t("dualControlEdits")?f(e):t("useShiftKey")?i(e):o(e))&&(e.target.closest(`${this.classes.markup}${this.classes.messageContent}`)||e.target.closest(this.classes.container))&&g.startEditMessage(...c)}}}})();
